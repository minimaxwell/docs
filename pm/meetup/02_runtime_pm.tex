\section{Power Management Dynamique}

\begin{frame}
	\frametitle{Power Management Dynamique}
	\center{\Large{Minimiser la consommation d'un système actif}}
	\begin{block}{Compromis}
	\begin{itemize}
		\item Ressources utilisées
		\item Ressources nécessaires
		\item Latences acceptables
		\item Consommation actuelle
		\item Température actuelle
	\end{itemize}
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{PM Core}
	\begin{block}{Au coeur du noyau}
		\begin{itemize}
			\item Synchronisation entre tous les composants
			\item API pour drivers, bindings device-tree
			\item PM dynamique et modes d'endormissement
		\end{itemize}
	\end{block}
\end{frame}
\begin{frame}
	\frametitle{runtime\_pm}
	\begin{block}{Controller dynamiquement l'état des périphériques}
		\begin{itemize}
			\item API : Callbacks, fonctions \texttt{pm\_runtime\_*}
			\item Basé sur du comptage de références
			\item Support de l'autosuspend
			\item Coordonné par le noyau
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{Quality of Service}
	Indiquer au noyau les latence et débits à respecter
	\begin{block}{Paramètres globaux}
		\begin{itemize}
			\item \texttt{cpu\_dma\_latency} (µs)
			\item \texttt{memory\_bandwidth} (mbps)
			\item \texttt{network\_latency} (µs)
			\item \texttt{network\_throughput} (kbps)
		\end{itemize}
	\end{block}
	Interface Userspace : \texttt{/dev/*} + sysfs
\end{frame}


\begin{frame}
	\frametitle{CPU Idle}
	\begin{block}{Que faire quand le CPU n'a rien à faire ?}
	\begin{itemize}
		\item Choix du mode (governor)
		\item Implémentation (driver)
	\end{itemize}
	\end{block}
	\begin{block}{struct cpuidle\_state}
		\begin{itemize}
			\item \texttt{flags}
			\item \texttt{exit\_latency}
			\item \texttt{power\_usage}
			\item \texttt{target\_residency}
			\item \texttt{int enter([...], int index)}
		\end{itemize}
	\end{block}
		powertop, /sys/devices/system/cpu/cpuX/cpuidle
\end{frame}

\begin{frame}[fragile]
	\frametitle{cpuidle i7 4702MQ}
	\begin{block}{i7 4702MQ}
\begin{verbatim}
name     latency  residency utilisation
C0       -        -         1.5%
POLL     0        0         0.2%
C1-HSW   2        2         0.6%
C1E-HSW  10       20        0.2%
C3-HSW   33       100       0.0%
C6-HSW   133      400       0.0%
C7s-HSW  166      500       97.4%
\end{verbatim}
		\end{block}
\end{frame}

\begin{frame}
	\frametitle{DVFS}
	\textbf{D}ynamic \textbf{V}oltage and \textbf{F}requency \textbf{S}caling
	\begin{block}{cpufreq}
		\begin{itemize}
			\item Implémentation hardware (policy)
			\item Implémentation software (governor) :
				\begin{itemize}
					\item \texttt{performance}
					\item \texttt{powersave}
					\item \texttt{ondemand}
					\item \texttt{conservative}
					\item \texttt{userspace}
					\item \texttt{schedutil} (linux 4.6)
				\end{itemize}
		\end{itemize}
		\texttt{/sys/devices/system/cpu/cpuX/cpufreq/}
	\end{block}
	\begin{block}{devfreq}
		Similaire pour les devices non-CPU
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{Operating Performance Points}
	\begin{block}{Tuples (Fréquence, Tension) pour un périphérique}
	\texttt{operating-points = <}

	\texttt{     /* kHz    uV */}

	\texttt{     792000  1100000}

	\texttt{     396000  950000}

	\texttt{     198000  850000}

	\texttt{     >;}
	\end{block}
\end{frame}
\begin{frame}
	\frametitle{thermal}
	Actions en fonction de la température
	\begin{block}{Thermal zone}
		\begin{itemize}
			\item Température (\texttt{trip\_point})
			\item Politique 
			\item Cooling device
		\end{itemize}
	\end{block}
	\begin{block}{Cooling device}
		\begin{itemize}
			\item Hardware : Ventilateur
			\item Software : cpufreq
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{Vue d'ensemble}
	\begin{block}{Composants liés}
		\begin{itemize}
			\item Scheduler
			\item cpuidle
			\item cpufreq
			\item thermal
		\end{itemize}
	\end{block}
	\begin{block}{A venir}
		\begin{itemize}
			\item Unifier cpuidle et cpufreq
			\item Energy Aware Scheduler
		\end{itemize}
	\end{block}
\end{frame}
